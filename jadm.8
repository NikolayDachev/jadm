.\" Manpage for jadm.
.\" Contact jadm@dachev.info to correct errors or typos.
.TH man 8 "09 Sep 2014" "1.0" "jadm man page"
.SH NAME
jadm (jail admin) \- FreeBSD jail framework with vnet, zfs and /etc/jail.conf support
.SH DESCRIPTION
Jadm provide jail framework which use only FreeBDS native /etc/jail.conf file.
Jadm just pars /etc/jail.conf file also use FreeBSD integrated zfs functionality, bsdinstall for jail creations (also src) and freebsd jail tools.
Jadm create custom /etc/jail.conf file with initsetup() function (make a backup if /etc/jail.conf exist)
Jadm use zfs for jail envoirment also bridge+epair interfaces for vnet(vimage) network

.br
.B Jadm can manage four different types of jails
.br
.TP
.B vnet support 
.br 
text
.TP
.B hared host system ip address
.br 
text
.TP
.B BASE (skeleton jail model)
.br 
text
.TP
.B normal jails
.br 
text

.SH REQUIREMENTS
.TP
.B 'option vimage' 
in FreeBSD custom kernel
.TP
.B already exinsting zfs pool
.TP
.B already existing bridge interface with ip address
you can use multiple ip's which are used for jails gateways for different network
.SH OPTIONS
.TP
.B initsetup
select existing bridge interface as default and jails home zfs (zpool should exist)
.TP
.B setup
.br
change bridge interface (if you change it please change and jails gatways/ip via modify option) and default jail home zfs (jadm will rename all jails home path to new zfs home)
.TP
.B create
.br
Easy interactive way to create new jail
.br
 
.br
.B Jail Name:>
this name will be used also for jail zfs home
.br
 
.br
.B Hostname:>
jail hostname example: jail.local.lan
.br
 
.br
.B Jail ID:>
will be used also for jail epair inteface number (vnet / bridge interface conection)
.br

.B Vnet support (y):> 
if (y) is selected jail will be created with vnet support.

.br
.B Gateway number:>
if is (vnet): show brige interfaces asignet ip addresses which are used for jail default gatway and jail network just select a number
.br

.B Jail IP Address:>
if is (vnet) jail ip address should be from them same newtwork with gateway ip, if is not (vnet) you can enter any valid ip address from the host system
 
.br
.B Jail ZFS Quota (M)egabytes, (G)igabytes, (none) for unlimited:>
enter zfs quota for jail use none (or leave it empty) if quota is not needed example: 10G
.br
 
.br
.B install source:>
jadm will ask how to install new jail
.br
 
.br
.B (template)
use existing jail like a template - (vnet) jaill cannot be used as (novnet) jail and vice versa. All jail local settings will be copyed to new jail
 
.br
.B (bsd)
use bdsinstaller which is similiar to new freebsd instalation. During this process bsdinstaller will use internet to donwload FreeBSD pkg's
.br
 
.br
.B (src)
jadm will build jail environment from FreeBSD sources /usr/src. You can make new buildworld or you can use already builded. Ony bsd system envoirment will be installed evrething else shold be installed manualy (like /usr/ports and etc.)
.br

.br
.B (skel)
jail skeleton model 'BASE' jails 
.br

.TP
After all required data is entered jadm will show summarise config and will ask for confirmation (y/n) In this stage jadm will create zfs path for your jail if this zfs path already exist jadm will ask how to proceed
.br
.B (recreate)
will destroy zfs path and existing data and will create new one with same name
.br
 
.br
.B (use)
will use existing zfs path (jail environment) and will complete installation
.br
.TP
After jail installation complete jadm will execute post install function with default settings for jail /etc/rc.conf and /etc/resolv.conf
.br

.br
.B /etc/jail.conf
.br
sendmail_enable="NONE"
.br
firewall_enable="YES"
.br
firewall_script="/etc/rc.firewall"
.br
firewall_type="OPEN"
.br
 
.br
.B /etc/resolv.conf
.br
nameserver 8.8.8.8

.TP
.B modify
.br
modify existing jail (name, hostname, jid, gateway, ip addr and zfs quota)
.TP
.B destroy
.br
remove jail config from /etc/jail.conf and destroy jail zfs data
.TP
.B remove
.br
remove jail config from /etc/jail.conf but will keep jail zfs data
.TP
.B migrate
migrate jail from on host to other. Jadm will migrate jail config via his own client/server.
Jail zfs will be migrated vis ssh.

1. server/client comunicate with jadm socket server (AES encrypted)
 - password for AES encription must be exactly 16 symbols if not jadm will add '0'
       
2. ssh public key for current user must be added to remote user@server:~/.ssh/authorized_keys 
 - remote user should be able to use (sudo zfs receive), do not use root!
 - zfs pool will be transferd via ssh
        
3. start server on remote machine before client on local

 server:
 - migrate server (ip address: def *) (port: def 4555) (server password)

 client:
 - migrate client (remote user@host/ip) (remote port: def 4555) (server password) (jail name/id)
.TP
.B snap
.br
Create jail zfs snapshot with special data/time number at the end
.TP
.B start, stop or reboot
.br
start stop or reboot jail. if jail name content "tmeplate" jadm will skip it when "start" is used
.TP
.B shell
.br
Enter in Jail (usage: shell 'name/jid').
.TP
.B local
.br
Jails local settings
.br
For local setting you can use all fine tunning jail options like 'mount.ftab' and etc. Local setting apply only to jail.
.TP
.B global
.br
Jails global settings
.br
For global setting you can use all fine tunning jail options like 'mount.ftab' and etc. Global setting apply only to all jails.

.TP
.B gateways
.br
List available Jail gateways on the system bridge interface (vnet)
.TP
.B list or jls
.br
List Jais by name, hostname, ipaddress, gateway, active, inactive (jls - show short table)
.TP
.B about
.br
show JADM version and license agreement
.TP
.B help
.br
list available commands with "help" or detailed help with "help cmd".
.TP
.B verbose
.br
by default is off. Show detailed message when jail is started
.TP
.B log
.br
add custom log messge to /var/log/jadm.log
.TP
.B quit or exit
.br
exit from JADM

.SH SEE ALSO
jail(8), jail.conf(5), zpool(8), zfs(8), ifconfig(8) and bridge(4)
.SH BUGS
If you find any bugs, or if you experience any crashes, please send report to jadm@dachev.info
.SH AUTHOR
Nikolay Georgiev Dachev (nikolay@dachev.info)
